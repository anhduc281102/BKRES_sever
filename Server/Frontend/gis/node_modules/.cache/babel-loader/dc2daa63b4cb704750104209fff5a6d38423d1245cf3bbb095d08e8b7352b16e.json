{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\AD\\\\Desktop\\\\GIS\\\\gis\\\\src\\\\components\\\\Main.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from 'react';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport axios from 'axios';\nimport '../styles/Main.css';\nimport iconUrl from '../assets/marker-icon.png';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Main() {\n  _s();\n  const mapContainer = useRef(null);\n  const [gateways, setGateways] = useState([]);\n  const [token, setToken] = useState('');\n  useEffect(() => {\n    // Lấy token từ localStorage\n    const storedToken = localStorage.getItem('Token');\n    if (storedToken) {\n      setToken(storedToken);\n    }\n  }, []);\n  useEffect(() => {\n    if (!mapContainer.current || gateways.length === 0) return;\n\n    // Khởi tạo bản đồ và đặt tọa độ trung tâm ở Việt Nam\n    const map = L.map(mapContainer.current).setView([16.4637, 107.5909], 6);\n\n    // Sử dụng bản đồ OpenStreetMap làm nền\n    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\n      attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\n    }).addTo(map);\n\n    // Tạo icon tùy chỉnh\n    const customIcon = L.icon({\n      iconUrl: iconUrl,\n      iconSize: [25, 41],\n      iconAnchor: [12, 41],\n      popupAnchor: [0, -41]\n    });\n\n    // Đánh dấu các điểm trạm trên bản đồ với icon tùy chỉnh\n    gateways.forEach(gateway => {\n      const {\n        lat,\n        lon\n      } = gateway.location[0];\n      L.marker([parseFloat(lat), parseFloat(lon)], {\n        icon: customIcon\n      }).addTo(map).bindPopup(`<b>${gateway.gateway_name}</b>`);\n    });\n  }, [mapContainer, gateways]);\n  useEffect(() => {\n    // Gọi API từ backend để lấy thông tin các trạm, sử dụng token\n    axios.post('http://sanslab.viewdns.net:5000/api/gateway/getallGateway', null, {\n      headers: {\n        'authorization': `Bearer ${token}` // Thêm token vào header Authorization\n      }\n    }).then(response => {\n      if (response.data.success) {\n        const gatewaysData = response.data.data.gateways;\n        setGateways(gatewaysData);\n      } else {\n        console.error('Lỗi khi lấy dữ liệu từ API');\n      }\n    }).catch(error => {\n      console.error('Lỗi khi gọi API:', error);\n    });\n  }, [token]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    ref: mapContainer,\n    id: \"map\",\n    className: \"map-container\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 69,\n    columnNumber: 12\n  }, this);\n}\n_s(Main, \"tfOZx0jQxt38dz9R8qnI6QZdjNs=\");\n_c = Main;\nexport default Main;\nvar _c;\n$RefreshReg$(_c, \"Main\");","map":{"version":3,"names":["React","useEffect","useRef","useState","L","axios","iconUrl","jsxDEV","_jsxDEV","Main","_s","mapContainer","gateways","setGateways","token","setToken","storedToken","localStorage","getItem","current","length","map","setView","tileLayer","attribution","addTo","customIcon","icon","iconSize","iconAnchor","popupAnchor","forEach","gateway","lat","lon","location","marker","parseFloat","bindPopup","gateway_name","post","headers","then","response","data","success","gatewaysData","console","error","catch","ref","id","className","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/AD/Desktop/GIS/gis/src/components/Main.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\r\nimport L from 'leaflet'; \r\nimport 'leaflet/dist/leaflet.css'; \r\nimport axios from 'axios';\r\nimport '../styles/Main.css';\r\nimport iconUrl from '../assets/marker-icon.png';\r\n\r\nfunction Main() {\r\n    const mapContainer = useRef(null);\r\n    const [gateways, setGateways] = useState([]);\r\n    const [token, setToken] = useState('');\r\n\r\n    useEffect(() => {\r\n        // Lấy token từ localStorage\r\n        const storedToken = localStorage.getItem('Token');\r\n        if (storedToken) {\r\n            setToken(storedToken);\r\n        }\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (!mapContainer.current || gateways.length === 0) return;\r\n\r\n        // Khởi tạo bản đồ và đặt tọa độ trung tâm ở Việt Nam\r\n        const map = L.map(mapContainer.current).setView([16.4637, 107.5909], 6);\r\n\r\n        // Sử dụng bản đồ OpenStreetMap làm nền\r\n        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {\r\n            attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n        }).addTo(map);\r\n\r\n        // Tạo icon tùy chỉnh\r\n        const customIcon = L.icon({\r\n            iconUrl: iconUrl,\r\n            iconSize: [25, 41],\r\n            iconAnchor: [12, 41],\r\n            popupAnchor: [0, -41]\r\n        });\r\n\r\n        // Đánh dấu các điểm trạm trên bản đồ với icon tùy chỉnh\r\n        gateways.forEach(gateway => {\r\n            const { lat, lon } = gateway.location[0];\r\n            L.marker([parseFloat(lat), parseFloat(lon)], { icon: customIcon })\r\n                .addTo(map)\r\n                .bindPopup(`<b>${gateway.gateway_name}</b>`);\r\n        });\r\n    }, [mapContainer, gateways]);\r\n\r\n    useEffect(() => {\r\n        // Gọi API từ backend để lấy thông tin các trạm, sử dụng token\r\n        axios.post('http://sanslab.viewdns.net:5000/api/gateway/getallGateway', null, {\r\n    headers:   \r\n        {'authorization': `Bearer ${token}` // Thêm token vào header Authorization\r\n}\r\n        })\r\n            .then(response => {\r\n                if (response.data.success) {\r\n                    const gatewaysData = response.data.data.gateways;\r\n                    setGateways(gatewaysData);\r\n                } else {\r\n                    console.error('Lỗi khi lấy dữ liệu từ API');\r\n                }\r\n            })\r\n            .catch(error => {\r\n                console.error('Lỗi khi gọi API:', error);\r\n            });\r\n    }, [token]);\r\n\r\n    return <div ref={mapContainer} id=\"map\" className=\"map-container\"></div>;\r\n}\r\n\r\nexport default Main;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}